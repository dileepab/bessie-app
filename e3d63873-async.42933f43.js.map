{"version":3,"sources":["node_modules/@ant-design/icons-svg/es/asn/LockOutlined.js","node_modules/@ant-design/icons/es/icons/LockOutlined.js","src/pages/User/Login/index.tsx"],"sourcesContent":["// This icon file is generated automatically.\nvar LockOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z\" } }] }, \"name\": \"lock\", \"theme\": \"outlined\" };\nexport default LockOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport LockOutlinedSvg from \"@ant-design/icons-svg/es/asn/LockOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar LockOutlined = function LockOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: LockOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(LockOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'LockOutlined';\n}\nexport default RefIcon;","import { Footer } from '@/components';\nimport { login } from '@/services/ant-design-pro/api';\nimport {\n  LockOutlined,\n  UserOutlined,\n} from '@ant-design/icons';\nimport {\n  LoginForm,\n  ProFormCheckbox,\n  ProFormText,\n} from '@ant-design/pro-components';\nimport { FormattedMessage, Helmet, history, SelectLang, useIntl, useModel } from '@umijs/max';\nimport { Alert, message } from 'antd';\nimport { createStyles } from 'antd-style';\nimport React, { useState } from 'react';\nimport { flushSync } from 'react-dom';\nimport Settings from '../../../../config/defaultSettings';\n\nconst useStyles = createStyles(({ token }) => {\n  return {\n    action: {\n      marginLeft: '8px',\n      color: 'rgba(0, 0, 0, 0.2)',\n      fontSize: '24px',\n      verticalAlign: 'middle',\n      cursor: 'pointer',\n      transition: 'color 0.3s',\n      '&:hover': {\n        color: token.colorPrimaryActive,\n      },\n    },\n    lang: {\n      width: 42,\n      height: 42,\n      lineHeight: '42px',\n      position: 'fixed',\n      right: 16,\n      borderRadius: token.borderRadius,\n      ':hover': {\n        backgroundColor: token.colorBgTextHover,\n      },\n    },\n    container: {\n      display: 'flex',\n      flexDirection: 'column',\n      height: '100vh',\n      overflow: 'auto',\n      backgroundImage:\n        \"url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')\",\n      backgroundSize: '100% 100%',\n    },\n  };\n});\n\nconst Lang = () => {\n  const { styles } = useStyles();\n\n  return (\n    <div className={styles.lang} data-lang>\n      {SelectLang && <SelectLang />}\n    </div>\n  );\n};\n\nconst LoginMessage: React.FC<{\n  content: string;\n}> = ({ content }) => {\n  return (\n    <Alert\n      style={{\n        marginBottom: 24,\n      }}\n      message={content}\n      type=\"error\"\n      showIcon\n    />\n  );\n};\n\nconst Login: React.FC = () => {\n  const [userLoginState, setUserLoginState] = useState<API.LoginResult>({});\n  const { initialState, setInitialState } = useModel('@@initialState');\n  const { styles } = useStyles();\n  const intl = useIntl();\n\n  const fetchUserInfo = async () => {\n    const userInfo = await initialState?.fetchUserInfo?.();\n    if (userInfo) {\n      flushSync(() => {\n        setInitialState((s) => ({\n          ...s,\n          currentUser: userInfo,\n        }));\n      });\n    }\n  };\n\n  const handleSubmit = async (values: API.LoginParams) => {\n    try {\n      const msg = await login({ ...values });\n      if (msg.status === 'ok') {\n        const defaultLoginSuccessMessage = intl.formatMessage({\n          id: 'pages.login.success',\n          defaultMessage: 'Login successful',\n        });\n        message.success(defaultLoginSuccessMessage);\n        await fetchUserInfo();\n        const urlParams = new URL(window.location.href).searchParams;\n        history.push(urlParams.get('redirect') || '/');\n        return;\n      }\n      console.log(msg);\n      setUserLoginState(msg);\n    } catch (error) {\n      const defaultLoginFailureMessage = intl.formatMessage({\n        id: 'pages.login.failure',\n        defaultMessage: 'Login failed',\n      });\n      console.log(error);\n      message.error(defaultLoginFailureMessage);\n    }\n  };\n  const { status, type: loginType } = userLoginState;\n\n  return (\n    <div className={styles.container}>\n      <Helmet>\n        <title>\n          {intl.formatMessage({\n            id: 'menu.login',\n            defaultMessage: 'Login',\n          })}\n          {Settings.title && ` - ${Settings.title}`}\n        </title>\n      </Helmet>\n      <Lang />\n      <div\n        style={{\n          flex: '1',\n          padding: '32px 0',\n        }}\n      >\n        <LoginForm\n          contentStyle={{\n            minWidth: 280,\n            maxWidth: '75vw',\n          }}\n          logo={<img alt=\"logo\" src=\"/logo.svg\" />}\n          title=\"BESSIE\"\n          subTitle={intl.formatMessage({ id: 'pages.layouts.userLayout.title' })}\n          initialValues={{\n            autoLogin: true,\n          }}\n          onFinish={async (values) => {\n            await handleSubmit(values as API.LoginParams);\n          }}\n        >\n\n          {status === 'error' && loginType === 'account' && (\n            <LoginMessage\n              content={intl.formatMessage({\n                id: 'pages.login.accountLogin.errorMessage',\n                defaultMessage: 'Incorrect username/password(admin/ant.design)',\n              })}\n            />\n          )}\n          <>\n            <ProFormText\n              name=\"username\"\n              fieldProps={{\n                size: 'large',\n                prefix: <UserOutlined />,\n              }}\n              placeholder={intl.formatMessage({\n                id: 'pages.login.username.placeholder',\n                defaultMessage: '用户名: admin or user',\n              })}\n              rules={[\n                {\n                  required: true,\n                  message: (\n                    <FormattedMessage\n                      id=\"pages.login.username.required\"\n                      defaultMessage=\"请输入用户名!\"\n                    />\n                  ),\n                },\n              ]}\n            />\n            <ProFormText.Password\n              name=\"password\"\n              fieldProps={{\n                size: 'large',\n                prefix: <LockOutlined />,\n              }}\n              placeholder={intl.formatMessage({\n                id: 'pages.login.password.placeholder',\n                defaultMessage: '密码: ant.design',\n              })}\n              rules={[\n                {\n                  required: true,\n                  message: (\n                    <FormattedMessage\n                      id=\"pages.login.password.required\"\n                      defaultMessage=\"请输入密码！\"\n                    />\n                  ),\n                },\n              ]}\n            />\n          </>\n          <div\n            style={{\n              marginBottom: 24,\n            }}\n          >\n            <ProFormCheckbox noStyle name=\"autoLogin\">\n              <FormattedMessage id=\"pages.login.rememberMe\" defaultMessage=\"Remember me\" />\n            </ProFormCheckbox>\n            <a\n              style={{\n                float: 'right',\n              }}\n            >\n              <FormattedMessage id=\"pages.login.forgotPassword\" defaultMessage=\"Forgot Password?\" />\n            </a>\n          </div>\n        </LoginForm>\n      </div>\n      <Footer />\n    </div>\n  );\n};\n\nexport default Login;\n"],"names":[],"mappings":"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"}